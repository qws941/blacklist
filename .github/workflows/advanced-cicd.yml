name: ðŸš€ Advanced Multi-Image CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      force_build:
        description: 'Force build all images'
        required: false
        default: 'false'
        type: boolean
      target_images:
        description: 'Target images (comma-separated: app,postgres,redis)'
        required: false
        default: 'all'

env:
  REGISTRY: registry.jclee.me
  REGISTRY_USER: admin
  PROJECT_NAME: blacklist

jobs:
  # ë³€ê²½ì‚¬í•­ ë¶„ì„ ë° ë²„ì „ ê³„ì‚°
  analyze-changes:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      build_app: ${{ steps.changes.outputs.app }}
      build_postgres: ${{ steps.changes.outputs.postgres }}
      build_redis: ${{ steps.changes.outputs.redis }}
      should_build: ${{ steps.decision.outputs.should_build }}
      
    steps:
    - name: ðŸ“¥ Checkout with full history
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ðŸ” ë³€ê²½ì‚¬í•­ ê°ì§€
      uses: dorny/paths-filter@v3
      id: changes
      with:
        filters: |
          app:
            - 'src/**'
            - 'main.py'
            - 'Dockerfile'
            - 'requirements.txt'
            - '.github/workflows/advanced-cicd.yml'
          postgres:
            - 'postgres.Dockerfile'
            - 'src/core/database/**'
            - 'instance/**'
          redis:
            - 'redis.Dockerfile'
            - 'config/redis/**'
            
    - name: ðŸ“ˆ ìžë™ ë²„ì „ ê³„ì‚°
      id: version
      run: |
        # ë§ˆì§€ë§‰ íƒœê·¸ ê°€ì ¸ì˜¤ê¸°
        LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
        echo "Last tag: $LAST_TAG"
        
        # ë²„ì „ ë²ˆí˜¸ íŒŒì‹±
        VERSION_WITHOUT_V=${LAST_TAG#v}
        IFS='.' read -ra VERSION_PARTS <<< "$VERSION_WITHOUT_V"
        MAJOR=${VERSION_PARTS[0]}
        MINOR=${VERSION_PARTS[1]}
        PATCH=${VERSION_PARTS[2]}
        
        # ì»¤ë°‹ ë©”ì‹œì§€ ê¸°ë°˜ ë²„ì „ ì¦ê°€ ê²°ì •
        COMMIT_MESSAGE=$(git log -1 --pretty=%B)
        
        if echo "$COMMIT_MESSAGE" | grep -qE "^(feat|FEAT|feature)"; then
          MINOR=$((MINOR + 1))
          PATCH=0
          BUMP_TYPE="minor"
        elif echo "$COMMIT_MESSAGE" | grep -qE "^(fix|FIX|bugfix|hotfix)"; then
          PATCH=$((PATCH + 1))
          BUMP_TYPE="patch"
        elif echo "$COMMIT_MESSAGE" | grep -qE "^(BREAKING|breaking)"; then
          MAJOR=$((MAJOR + 1))
          MINOR=0
          PATCH=0
          BUMP_TYPE="major"
        else
          PATCH=$((PATCH + 1))
          BUMP_TYPE="patch"
        fi
        
        NEW_VERSION="v${MAJOR}.${MINOR}.${PATCH}"
        SHORT_SHA=$(git rev-parse --short HEAD)
        BUILD_NUMBER=$(date +%Y%m%d%H%M%S)
        
        echo "version=$NEW_VERSION" >> $GITHUB_OUTPUT
        echo "short_sha=$SHORT_SHA" >> $GITHUB_OUTPUT
        echo "build_number=$BUILD_NUMBER" >> $GITHUB_OUTPUT
        echo "bump_type=$BUMP_TYPE" >> $GITHUB_OUTPUT
        
        echo "ðŸ·ï¸ New version: $NEW_VERSION ($BUMP_TYPE bump)"
        echo "ðŸ“‹ Build: $BUILD_NUMBER"
        echo "ðŸ“ SHA: $SHORT_SHA"
        
    - name: ðŸŽ¯ ë¹Œë“œ ê²°ì •
      id: decision
      run: |
        FORCE_BUILD="${{ github.event.inputs.force_build }}"
        TARGET_IMAGES="${{ github.event.inputs.target_images }}"
        
        # PRì¸ ê²½ìš° ë¹Œë“œí•˜ì§€ ì•ŠìŒ
        if [[ "${{ github.event_name }}" == "pull_request" ]]; then
          echo "should_build=false" >> $GITHUB_OUTPUT
          echo "ðŸ“ PR ì´ë²¤íŠ¸ - ë¹Œë“œ ìŠ¤í‚µ"
          exit 0
        fi
        
        # ê°•ì œ ë¹Œë“œì¸ ê²½ìš°
        if [[ "$FORCE_BUILD" == "true" ]]; then
          echo "should_build=true" >> $GITHUB_OUTPUT
          echo "ðŸ”¨ ê°•ì œ ë¹Œë“œ ì‹¤í–‰"
          exit 0
        fi
        
        # ë³€ê²½ì‚¬í•­ì´ ìžˆëŠ” ê²½ìš°ë§Œ ë¹Œë“œ
        if [[ "${{ steps.changes.outputs.app }}" == "true" || \
              "${{ steps.changes.outputs.postgres }}" == "true" || \
              "${{ steps.changes.outputs.redis }}" == "true" ]]; then
          echo "should_build=true" >> $GITHUB_OUTPUT
          echo "âœ… ë³€ê²½ì‚¬í•­ ê°ì§€ - ë¹Œë“œ ì‹¤í–‰"
        else
          echo "should_build=false" >> $GITHUB_OUTPUT
          echo "ðŸ“­ ë³€ê²½ì‚¬í•­ ì—†ìŒ - ë¹Œë“œ ìŠ¤í‚µ"
        fi

  # ë©€í‹° ì´ë¯¸ì§€ ë³‘ë ¬ ë¹Œë“œ
  build-images:
    needs: analyze-changes
    if: needs.analyze-changes.outputs.should_build == 'true'
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: app
            dockerfile: Dockerfile
            context: .
            build_condition: ${{ needs.analyze-changes.outputs.build_app }}
          - name: postgres  
            dockerfile: postgres.Dockerfile
            context: .
            build_condition: ${{ needs.analyze-changes.outputs.build_postgres }}
          - name: redis
            dockerfile: redis.Dockerfile
            context: .
            build_condition: ${{ needs.analyze-changes.outputs.build_redis }}
            
    steps:
    - name: â­ï¸ ë¹Œë“œ ì¡°ê±´ í™•ì¸
      id: should_build_image
      run: |
        FORCE_BUILD="${{ github.event.inputs.force_build }}"
        TARGET_IMAGES="${{ github.event.inputs.target_images }}"
        IMAGE_NAME="${{ matrix.name }}"
        BUILD_CONDITION="${{ matrix.build_condition }}"
        
        # ê°•ì œ ë¹Œë“œ ë˜ëŠ” all íƒ€ê²Ÿì¸ ê²½ìš°
        if [[ "$FORCE_BUILD" == "true" ]] || [[ "$TARGET_IMAGES" == "all" ]]; then
          echo "should_build=true" >> $GITHUB_OUTPUT
          echo "ðŸ”¨ $IMAGE_NAME ì´ë¯¸ì§€ ë¹Œë“œ ì˜ˆì • (ê°•ì œ/ì „ì²´)"
          exit 0
        fi
        
        # íŠ¹ì • íƒ€ê²Ÿ ì§€ì •ëœ ê²½ìš°
        if [[ "$TARGET_IMAGES" == *"$IMAGE_NAME"* ]]; then
          echo "should_build=true" >> $GITHUB_OUTPUT
          echo "ðŸŽ¯ $IMAGE_NAME ì´ë¯¸ì§€ ë¹Œë“œ ì˜ˆì • (íƒ€ê²Ÿ ì§€ì •)"
          exit 0
        fi
        
        # ë³€ê²½ì‚¬í•­ ê¸°ë°˜ ë¹Œë“œ
        if [[ "$BUILD_CONDITION" == "true" ]]; then
          echo "should_build=true" >> $GITHUB_OUTPUT
          echo "ðŸ“ $IMAGE_NAME ì´ë¯¸ì§€ ë¹Œë“œ ì˜ˆì • (ë³€ê²½ì‚¬í•­)"
        else
          echo "should_build=false" >> $GITHUB_OUTPUT
          echo "â­ï¸ $IMAGE_NAME ì´ë¯¸ì§€ ë¹Œë“œ ìŠ¤í‚µ"
        fi
        
    - name: ðŸ“¥ Checkout ì½”ë“œ
      if: steps.should_build_image.outputs.should_build == 'true'
      uses: actions/checkout@v4
      
    - name: ðŸ—ï¸ Docker Buildx ì„¤ì •
      if: steps.should_build_image.outputs.should_build == 'true'
      uses: docker/setup-buildx-action@v3
      
    - name: ðŸ” í”„ë¼ì´ë¹— ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¡œê·¸ì¸
      if: steps.should_build_image.outputs.should_build == 'true'
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ env.REGISTRY_USER }}
        password: ${{ secrets.REGISTRY_PASSWORD }}
        
    - name: ðŸ“‹ ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° ìƒì„±
      if: steps.should_build_image.outputs.should_build == 'true'
      id: meta
      uses: docker/metadata-action@v5
      with:
        images: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-${{ matrix.name }}
        tags: |
          type=raw,value=latest,enable={{is_default_branch}}
          type=raw,value=${{ needs.analyze-changes.outputs.version }}
          type=raw,value=${{ needs.analyze-changes.outputs.version }}-{{sha}}
          type=raw,value=build-${{ needs.analyze-changes.outputs.build_number }}
        labels: |
          org.opencontainers.image.title=${{ env.PROJECT_NAME }}-${{ matrix.name }}
          org.opencontainers.image.description=Blacklist Management System - ${{ matrix.name }}
          org.opencontainers.image.version=${{ needs.analyze-changes.outputs.version }}
          org.opencontainers.image.vendor=jclee
          
    - name: ðŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
      if: steps.should_build_image.outputs.should_build == 'true'
      uses: docker/build-push-action@v5
      with:
        context: ${{ matrix.context }}
        file: ${{ matrix.dockerfile }}
        platforms: linux/amd64,linux/arm64
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        labels: ${{ steps.meta.outputs.labels }}
        cache-from: type=gha,scope=${{ matrix.name }}
        cache-to: type=gha,mode=max,scope=${{ matrix.name }}
        build-args: |
          BUILDTIME=${{ fromJSON(steps.meta.outputs.json).labels['org.opencontainers.image.created'] }}
          VERSION=${{ needs.analyze-changes.outputs.version }}
          BUILD_NUMBER=${{ needs.analyze-changes.outputs.build_number }}
          
    - name: âœ… ë¹Œë“œ ê²°ê³¼ ì¶œë ¥
      if: steps.should_build_image.outputs.should_build == 'true'
      run: |
        echo "ðŸŽ‰ ${{ matrix.name }} ì´ë¯¸ì§€ ë¹Œë“œ ì™„ë£Œ!"
        echo "ðŸ“¦ ì´ë¯¸ì§€: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-${{ matrix.name }}"
        echo "ðŸ·ï¸ ë²„ì „: ${{ needs.analyze-changes.outputs.version }}"
        echo "ðŸ“ íƒœê·¸ë“¤:"
        echo "${{ steps.meta.outputs.tags }}" | sed 's/^/  - /'

  # ì´ë¯¸ì§€ ë³´ì•ˆ ìŠ¤ìº”
  security-scan:
    needs: [analyze-changes, build-images]
    if: needs.analyze-changes.outputs.should_build == 'true'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        image: [app, postgres, redis]
        
    steps:
    - name: ðŸ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¡œê·¸ì¸
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ env.REGISTRY_USER }}
        password: ${{ secrets.REGISTRY_PASSWORD }}
        
    - name: ðŸ›¡ï¸ ë³´ì•ˆ ìŠ¤ìº”
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-${{ matrix.image }}:${{ needs.analyze-changes.outputs.version }}
        format: 'sarif'
        output: 'trivy-results-${{ matrix.image }}.sarif'
        
    - name: ðŸ“Š ë³´ì•ˆ ìŠ¤ìº” ê²°ê³¼ ì—…ë¡œë“œ
      uses: github/codeql-action/upload-sarif@v3
      if: always()
      with:
        sarif_file: 'trivy-results-${{ matrix.image }}.sarif'

  # í†µí•© í…ŒìŠ¤íŠ¸
  integration-test:
    needs: [analyze-changes, build-images]
    if: needs.analyze-changes.outputs.should_build == 'true'
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout ì½”ë“œ
      uses: actions/checkout@v4
      
    - name: ðŸ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¡œê·¸ì¸
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ env.REGISTRY_USER }}
        password: ${{ secrets.REGISTRY_PASSWORD }}
        
    - name: ðŸ—ï¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì„±
      run: |
        # docker-compose.test.yml ìƒì„±
        cat > docker-compose.test.yml << EOF
        version: '3.8'
        services:
          postgres:
            image: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-postgres:${{ needs.analyze-changes.outputs.version }}
            environment:
              POSTGRES_DB: blacklist_test
              POSTGRES_USER: test
              POSTGRES_PASSWORD: test123
            ports:
              - "5432:5432"
              
          redis:
            image: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-redis:${{ needs.analyze-changes.outputs.version }}
            ports:
              - "6379:6379"
              
          app:
            image: ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-app:${{ needs.analyze-changes.outputs.version }}
            depends_on:
              - postgres
              - redis
            environment:
              POSTGRES_HOST: postgres
              POSTGRES_USER: test
              POSTGRES_PASSWORD: test123
              POSTGRES_DB: blacklist_test
              REDIS_HOST: redis
              FLASK_ENV: testing
            ports:
              - "2542:2542"
        EOF
        
    - name: ðŸ§ª í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      run: |
        echo "ðŸš€ í†µí•© í…ŒìŠ¤íŠ¸ ì‹œìž‘..."
        
        # ì»¨í…Œì´ë„ˆ ì‹œìž‘
        docker-compose -f docker-compose.test.yml up -d
        
        # ì„œë¹„ìŠ¤ ì‹œìž‘ ëŒ€ê¸°
        sleep 60
        
        # í—¬ìŠ¤ì²´í¬
        for i in {1..10}; do
          if curl -f http://localhost:2542/health; then
            echo "âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ í—¬ìŠ¤ì²´í¬ ì„±ê³µ!"
            break
          fi
          echo "â³ í—¬ìŠ¤ì²´í¬ ìž¬ì‹œë„ ($i/10)..."
          sleep 10
        done
        
        # ë¡œê·¸ í™•ì¸
        echo "ðŸ“‹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸:"
        docker-compose -f docker-compose.test.yml logs app | tail -20
        
        # ì •ë¦¬
        docker-compose -f docker-compose.test.yml down -v
        
        echo "ðŸŽ‰ í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"

  # ë²„ì „ íƒœê·¸ ìƒì„± ë° ë¦´ë¦¬ì¦ˆ
  release:
    needs: [analyze-changes, build-images, security-scan, integration-test]
    if: needs.analyze-changes.outputs.should_build == 'true' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout ì½”ë“œ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ðŸ·ï¸ Git íƒœê·¸ ìƒì„±
      run: |
        VERSION="${{ needs.analyze-changes.outputs.version }}"
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        
        # íƒœê·¸ ìƒì„±
        git tag -a "$VERSION" -m "Release $VERSION
        
        ðŸš€ ìžë™ ë¦´ë¦¬ì¦ˆ ìƒì„±
        ðŸ“… ë¹Œë“œ ì‹œê°„: $(date)
        ðŸ“ ì»¤ë°‹: ${{ github.sha }}
        ðŸ·ï¸ ë²„ì „: $VERSION
        
        ë¹Œë“œëœ ì´ë¯¸ì§€:
        - ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-app:$VERSION
        - ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-postgres:$VERSION  
        - ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-redis:$VERSION"
        
        git push origin "$VERSION"
        
    - name: ðŸ“° GitHub Release ìƒì„±
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ needs.analyze-changes.outputs.version }}
        release_name: Release ${{ needs.analyze-changes.outputs.version }}
        body: |
          ## ðŸš€ Blacklist Management System ${{ needs.analyze-changes.outputs.version }}
          
          ### ðŸ“¦ Docker Images
          - `${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-app:${{ needs.analyze-changes.outputs.version }}`
          - `${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-postgres:${{ needs.analyze-changes.outputs.version }}`
          - `${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-redis:${{ needs.analyze-changes.outputs.version }}`
          
          ### ðŸ”„ ì—…ë°ì´íŠ¸ ë°©ë²•
          ```bash
          # ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
          docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-app:${{ needs.analyze-changes.outputs.version }}
          docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-postgres:${{ needs.analyze-changes.outputs.version }}
          docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-redis:${{ needs.analyze-changes.outputs.version }}
          
          # ë˜ëŠ” latest íƒœê·¸ ì‚¬ìš©
          docker-compose pull && docker-compose up -d
          ```
          
          ### ðŸ“‹ ë³€ê²½ì‚¬í•­
          - ì•± ë³€ê²½: ${{ needs.analyze-changes.outputs.build_app == 'true' && 'âœ…' || 'âŒ' }}
          - DB ë³€ê²½: ${{ needs.analyze-changes.outputs.build_postgres == 'true' && 'âœ…' || 'âŒ' }}  
          - Redis ë³€ê²½: ${{ needs.analyze-changes.outputs.build_redis == 'true' && 'âœ…' || 'âŒ' }}
          
          ### ðŸ”— ì¶”ê°€ ì •ë³´
          - ë¹Œë“œ ë²ˆí˜¸: ${{ needs.analyze-changes.outputs.build_number }}
          - ì»¤ë°‹ SHA: ${{ github.sha }}
          - ë¸Œëžœì¹˜: ${{ github.ref_name }}
        draft: false
        prerelease: false

  # ì•Œë¦¼ ë° ìš”ì•½
  notify:
    needs: [analyze-changes, build-images, security-scan, integration-test, release]
    if: always()
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“Š íŒŒì´í”„ë¼ì¸ ìš”ì•½
      run: |
        echo "## ðŸš€ CI/CD íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“‹ ê¸°ë³¸ ì •ë³´" >> $GITHUB_STEP_SUMMARY
        echo "- **ì´ë²¤íŠ¸**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **ë¸Œëžœì¹˜**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **ì»¤ë°‹**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "- **ë²„ì „**: ${{ needs.analyze-changes.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ðŸ”„ ë³€ê²½ì‚¬í•­ ë¶„ì„" >> $GITHUB_STEP_SUMMARY
        echo "- **ì•±**: ${{ needs.analyze-changes.outputs.build_app == 'true' && 'âœ… ë³€ê²½ë¨' || 'âŒ ë³€ê²½ì—†ìŒ' }}" >> $GITHUB_STEP_SUMMARY
        echo "- **PostgreSQL**: ${{ needs.analyze-changes.outputs.build_postgres == 'true' && 'âœ… ë³€ê²½ë¨' || 'âŒ ë³€ê²½ì—†ìŒ' }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Redis**: ${{ needs.analyze-changes.outputs.build_redis == 'true' && 'âœ… ë³€ê²½ë¨' || 'âŒ ë³€ê²½ì—†ìŒ' }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ðŸ“¦ ë¹Œë“œ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
        if [[ "${{ needs.build-images.result }}" == "success" ]]; then
          echo "- **ë¹Œë“œ**: âœ… ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
        else
          echo "- **ë¹Œë“œ**: âŒ ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [[ "${{ needs.security-scan.result }}" == "success" ]]; then
          echo "- **ë³´ì•ˆ ìŠ¤ìº”**: âœ… ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
        else
          echo "- **ë³´ì•ˆ ìŠ¤ìº”**: âŒ ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [[ "${{ needs.integration-test.result }}" == "success" ]]; then
          echo "- **í†µí•© í…ŒìŠ¤íŠ¸**: âœ… í†µê³¼" >> $GITHUB_STEP_SUMMARY
        else
          echo "- **í†µí•© í…ŒìŠ¤íŠ¸**: âŒ ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [[ "${{ needs.release.result }}" == "success" ]]; then
          echo "- **ë¦´ë¦¬ì¦ˆ**: âœ… ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
        else
          echo "- **ë¦´ë¦¬ì¦ˆ**: âŒ ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“± ì´ë¯¸ì§€ ì •ë³´" >> $GITHUB_STEP_SUMMARY
        echo "```bash" >> $GITHUB_STEP_SUMMARY
        echo "# ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ëª…ë ¹ì–´" >> $GITHUB_STEP_SUMMARY
        echo "docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-app:${{ needs.analyze-changes.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-postgres:${{ needs.analyze-changes.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "docker pull ${{ env.REGISTRY }}/${{ env.PROJECT_NAME }}-redis:${{ needs.analyze-changes.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "```" >> $GITHUB_STEP_SUMMARY