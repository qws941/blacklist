# ===================================================
# Blacklist Management System - Unified Environment
# Version: v1.0.37
# Created: 2025-08-22
# Purpose: Single environment file for all deployments
# ===================================================

# === DEPLOYMENT ENVIRONMENT ===
# Options: development, production, testing
DEPLOYMENT_ENV=production

# === CONTAINER IMAGE CONFIGURATION ===
REGISTRY_URL=registry.jclee.me
IMAGE_TAG=latest
REDIS_TAG=latest
POSTGRES_TAG=latest

# === NETWORK AND PORT CONFIGURATION ===
# External ports (host machine)
EXTERNAL_PORT=32542
REDIS_EXTERNAL_PORT=32543
POSTGRES_EXTERNAL_PORT=32544
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000

# Internal ports (containers)
INTERNAL_PORT=2542

# Network configuration
NETWORK_SUBNET=172.20.0.0/16
NETWORK_GATEWAY=172.20.0.1

# === APPLICATION CORE SETTINGS ===
FLASK_ENV=production
DEBUG=false
SECRET_KEY=change-this-secret-key-in-production-use-strong-random-key
JWT_SECRET_KEY=change-this-jwt-secret-in-production-use-different-key

# === DATABASE CONFIGURATION (PostgreSQL) ===
POSTGRES_DB=blacklist
POSTGRES_USER=blacklist_user
POSTGRES_PASSWORD=blacklist_password_change_me_strong_password

# Database connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=40
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=1800
DATABASE_POOL_PRE_PING=true

# PostgreSQL Performance Settings
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB
POSTGRES_MAINTENANCE_WORK_MEM=64MB
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_WAL_BUFFERS=16MB
POSTGRES_DEFAULT_STATISTICS_TARGET=100
POSTGRES_RANDOM_PAGE_COST=1.1
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200
POSTGRES_WORK_MEM=16MB
POSTGRES_MAX_WORKER_PROCESSES=4
POSTGRES_MAX_PARALLEL_WORKERS_PER_GATHER=2
POSTGRES_MAX_PARALLEL_WORKERS=4
POSTGRES_MAX_PARALLEL_MAINTENANCE_WORKERS=2

# === REDIS CACHE CONFIGURATION ===
REDIS_MAXMEMORY=1gb
REDIS_MAXMEMORY_POLICY=allkeys-lru
REDIS_SAVE="900 1 300 10 60 10000"
REDIS_APPENDONLY=yes
REDIS_APPENDFSYNC=everysec
REDIS_TCP_KEEPALIVE=60
REDIS_TIMEOUT=300

# Cache settings
CACHE_DEFAULT_TTL=300
CACHE_MAX_ENTRIES=1000

# === COLLECTION SYSTEM SETTINGS ===
COLLECTION_ENABLED=true
FORCE_DISABLE_COLLECTION=false
RESTART_PROTECTION=false
AUTO_EXTRACT_COOKIES=true
MAX_AUTH_ATTEMPTS=5
BLOCK_DURATION_HOURS=1

# === AUTHENTICATION & SECURITY ===
JWT_ACCESS_TOKEN_EXPIRES=3600
JWT_REFRESH_TOKEN_EXPIRES=86400
JWT_ENABLED=true
API_KEY_ENABLED=true
DEFAULT_API_KEY=blk_default_key_change_in_production
ADMIN_USERNAME=admin
ADMIN_PASSWORD=generate_strong_admin_password_here

# Security headers
SECURITY_HEADERS_ENABLED=true
RATE_LIMIT_ENABLED=true
RATE_LIMIT_API=1000/hour

# === EXTERNAL SERVICES ===
# REGTECH Configuration
REGTECH_USERNAME=your-regtech-username
REGTECH_PASSWORD=your-regtech-password
REGTECH_BASE_URL=https://regtech.fsec.or.kr

# SECUDIUM Configuration
SECUDIUM_USERNAME=your-secudium-username
SECUDIUM_PASSWORD=your-secudium-password
SECUDIUM_BASE_URL=https://isap.secudium.co.kr

# === REGISTRY AUTHENTICATION ===
REGISTRY_USERNAME=your-registry-username
REGISTRY_PASSWORD=your-registry-password

# === PERFORMANCE OPTIMIZATION ===
# Gunicorn Configuration
GUNICORN_WORKERS=4
GUNICORN_THREADS=2
GUNICORN_WORKER_CLASS=gthread
GUNICORN_WORKER_CONNECTIONS=1000
GUNICORN_TIMEOUT=60
GUNICORN_KEEPALIVE=5
GUNICORN_MAX_REQUESTS=1000
GUNICORN_MAX_REQUESTS_JITTER=50
GUNICORN_PRELOAD_APP=false

# Python Optimization (for high-performance environments)
PYTHONOPTIMIZE=0
PYTHONDONTWRITEBYTECODE=0
WERKZEUG_RUN_MAIN=false
FLASK_SKIP_DOTENV=0

# === LOGGING CONFIGURATION ===
LOG_LEVEL=WARNING
LOG_FORMAT=json
HEALTH_CHECK_TIMEOUT=30
HEALTH_CHECK_INTERVAL=60

# === FEATURE FLAGS ===
ENABLE_V2_API=true
ENABLE_COOKIE_COLLECTION=true
ENABLE_METRICS=true
PROMETHEUS_ENABLED=true

# === RESOURCE LIMITS ===
# Main Application
CPU_LIMIT=1.0
MEMORY_LIMIT=1G
CPU_RESERVATION=0.5
MEMORY_RESERVATION=512M
PERFORMANCE_OPTIMIZED=false

# Redis Limits
REDIS_CPU_LIMIT=1.0
REDIS_MEMORY_LIMIT=1.5G
REDIS_CPU_RESERVATION=0.25
REDIS_MEMORY_RESERVATION=256M

# PostgreSQL Limits
POSTGRES_CPU_LIMIT=2.0
POSTGRES_MEMORY_LIMIT=2G
POSTGRES_CPU_RESERVATION=0.5
POSTGRES_MEMORY_RESERVATION=512M

# Monitoring Services
PROMETHEUS_CPU_LIMIT=1.0
PROMETHEUS_MEMORY_LIMIT=1G
PROMETHEUS_CPU_RESERVATION=0.25
PROMETHEUS_MEMORY_RESERVATION=256M
PROMETHEUS_RETENTION=7d
PROMETHEUS_WATCHTOWER_ENABLED=false

GRAFANA_CPU_LIMIT=0.5
GRAFANA_MEMORY_LIMIT=512M
GRAFANA_CPU_RESERVATION=0.1
GRAFANA_MEMORY_RESERVATION=128M
GRAFANA_PASSWORD=admin
GRAFANA_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource
GRAFANA_WATCHTOWER_ENABLED=false

# === WATCHTOWER AUTO-UPDATE ===
WATCHTOWER_INTERVAL=300
WATCHTOWER_NOTIFICATIONS=
SLACK_WEBHOOK_URL=
SLACK_CHANNEL=#alerts
WATCHTOWER_DEBUG=false
WATCHTOWER_LOG_LEVEL=info
WATCHTOWER_SCHEDULE=
WATCHTOWER_EXTRA_ARGS=

# === VOLUME CONFIGURATION ===
# Volume mount type: "none" for bind mounts, "local" for named volumes
VOLUME_TYPE=none
VOLUME_OPTS=bind

# Data paths (adjust according to your deployment)
DATA_PATH=./data/blacklist
LOGS_PATH=./logs
REDIS_DATA_PATH=./data/redis
POSTGRES_DATA_PATH=./data/postgresql
PROMETHEUS_DATA_PATH=./data/prometheus
GRAFANA_DATA_PATH=./data/grafana

# ===================================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# ===================================================
# Uncomment and modify the appropriate section below

# --- DEVELOPMENT ENVIRONMENT ---
# FLASK_ENV=development
# DEBUG=true
# LOG_LEVEL=DEBUG
# COLLECTION_ENABLED=false
# FORCE_DISABLE_COLLECTION=true
# GUNICORN_WORKERS=2
# GUNICORN_THREADS=1
# DATABASE_POOL_SIZE=5
# REDIS_MAXMEMORY=256mb

# --- PRODUCTION ENVIRONMENT ---
# FLASK_ENV=production
# DEBUG=false
# LOG_LEVEL=WARNING
# COLLECTION_ENABLED=true
# FORCE_DISABLE_COLLECTION=false
# PYTHONOPTIMIZE=2
# PYTHONDONTWRITEBYTECODE=1
# GUNICORN_PRELOAD_APP=true

# --- HIGH-PERFORMANCE ENVIRONMENT ---
# PERFORMANCE_OPTIMIZED=true
# GUNICORN_WORKERS=6
# GUNICORN_THREADS=4
# DATABASE_POOL_SIZE=30
# DATABASE_MAX_OVERFLOW=60
# REDIS_MAXMEMORY=2gb
# CPU_LIMIT=2.0
# MEMORY_LIMIT=2G
# POSTGRES_SHARED_BUFFERS=512MB
# POSTGRES_EFFECTIVE_CACHE_SIZE=2GB

# --- TESTING ENVIRONMENT ---
# FLASK_ENV=testing
# DEBUG=true
# COLLECTION_ENABLED=false
# FORCE_DISABLE_COLLECTION=true
# DATABASE_POOL_SIZE=5
# LOG_LEVEL=ERROR